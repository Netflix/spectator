<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>TDigest - Spectator Docs</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/custom.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "TDigest";
    var mkdocs_page_input_path = "registry/tdigest.md";
    var mkdocs_page_url = "/registry/tdigest/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Spectator Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Getting Started</span></li>

        
            
    <ul class="subnav">
    <li><span>Meter Types</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../intro/counter/">Counters</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../intro/timer/">Timers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../intro/gauge/">Gauges</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../intro/dist-summary/">Distribution Summaries</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../intro/conventions/">Naming Conventions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../intro/testing/">Testing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../intro/netflix/">Netflix Integration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../intro/servo-comparison/">Servo Comparison</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Extensions</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-buffer-pools/">Buffer Pools</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-gc/">Garbage Collection</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-gc-causes/">GC Causes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-memory-pools/">Memory Pools</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/log4j2/">Log4j2 Appender</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Registries</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../metrics3/">Metrics3</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../servo/">Servo</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">TDigest</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#t-digest-registry">T-Digest Registry</a></li>
                
                    <li><a class="toctree-l4" href="#getting-started">Getting Started</a></li>
                
                    <li><a class="toctree-l4" href="#recommendations">Recommendations</a></li>
                
                    <li><a class="toctree-l4" href="#testing">Testing</a></li>
                
                    <li><a class="toctree-l4" href="#known-issues">Known Issues</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../reports/">Build Reports</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Spectator Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Registries &raquo;</li>
        
      
    
    <li>TDigest</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/Netflix/spectator" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="t-digest-registry">T-Digest Registry<a class="headerlink" href="#t-digest-registry" title="Permanent link">&para;</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Deprecated, use PercentileTimer or PercentileDistributionSummary instead.</p>
</div>
<p>The TDigest registry is used for collecting dimensional percentile data and reporting to
backends. This is currently an experiment and not ready for general use. Current instructions
assume it is being used <a href="../Netflix-Integration">internally at Netflix</a>.</p>
<h2 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h2>
<p>To use it simply add a dependency:</p>
<pre><code>com.netflix.spectator:spectator-reg-tdigest:0.38.0
</code></pre>

<p>Add the <code>TDigestModule</code> to the set of modules used with guice:</p>
<pre><code class="java">Injector injector = Guice.createInjector(
  new SpectatorModule(),
  new TDigestModule(),
  ...);
</code></pre>

<p>Then just inject the <code>TDigestRegistry</code>:</p>
<pre><code class="java">public class Foo {
  private final Registry registry;

  public Foo(TDigestRegistry digestRegistry) {
    registry = digestRegistry;
  }

  public void doSomething() {
    registry.timer(&quot;foo.doSomething&quot;).record(() -&gt; {
      ... something ...
    });
  }
}
</code></pre>

<p>Timers and distribution summaries accessed via the <code>TDigestRegistry</code> will be recorded to both
the main registry and the digest registry.</p>
<h2 id="recommendations">Recommendations<a class="headerlink" href="#recommendations" title="Permanent link">&para;</a></h2>
<ul>
<li>Use digests sparingly. The digest structure will take more memory locally and have additional
overhead compared to typical implementations. </li>
</ul>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<p>For unit tests use the <code>TDigestTestModule</code> to get an injectable <code>TDigestRegistry</code>. Then follow
the <a href="../Testing">normal testing instructions</a>. Example:</p>
<pre><code class="java">@RunWith(JUnit4.class)
public class FooTest {

  @Test
  public void doSomething() throws Exception {
    Injector injector = Guice.createInjector(TDigestTestModule.create());
    injector.getInstance(Foo.class).doSomething();

    final TDigestRegistry r = injector.getInstance(TDigestRegistry.class);
    Assert.assertEquals(1, r.timer(&quot;foo&quot;).count());
    Assert.assertEquals(42, r.timer(&quot;foo&quot;).totalTime());
  }

  private static class Foo {
    private final Timer t;

    @Inject
    Foo(TDigestRegistry registry) {
      t = registry.timer(&quot;foo&quot;);
    }

    void doSomething() {
      t.record(42, TimeUnit.NANOSECONDS);
    }
  }
}
</code></pre>

<h2 id="known-issues">Known Issues<a class="headerlink" href="#known-issues" title="Permanent link">&para;</a></h2>
<ul>
<li>Only reports to kinesis for now. This will be changed after the configuration format is
  figured out.</li>
<li>There is still some debate about whether to control the access via the code and injecting
  the specific registry or using configuration. </li>
<li>There is work in progress on having a fixed limit to protect both the local client and
  backends. If the limit is reached rollup policies would get triggered to gracefully degrade.</li>
<li>Can we support high level digest along with basic timer with more dimensionality. Still
  investigating pending the outcome of previous bullets.</li>
<li>Not yet supported via sidecar endpoints.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../reports/" class="btn btn-neutral float-right" title="Build Reports">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../servo/" class="btn btn-neutral" title="Servo"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/Netflix/spectator" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../servo/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../reports/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
