<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Servo Comparison - Spectator Docs</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/custom.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Servo Comparison";
    var mkdocs_page_input_path = "intro/servo-comparison.md";
    var mkdocs_page_url = "/intro/servo-comparison/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-82153845-2', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Spectator Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Getting Started</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../registry/">Registry</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Meter Types</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../counter/">Counters</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../timer/">Timers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../gauge/">Gauges</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../dist-summary/">Distribution Summaries</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../clock/">Clock</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../conventions/">Naming Conventions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../testing/">Testing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../netflix/">Netflix Integration</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Servo Comparison</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#servo-comparison">Servo Comparison</a></li>
                
                    <li><a class="toctree-l4" href="#differences">Differences</a></li>
                
                    <li><a class="toctree-l4" href="#migration">Migration</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Extensions</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-buffer-pools/">Buffer Pools</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-gc/">Garbage Collection</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-gc-causes/">GC Causes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-memory-pools/">Memory Pools</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/log4j2/">Log4j2 Appender</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/placeholders/">Placeholders</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Registries</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../registry/metrics3/">Metrics3</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../registry/servo/">Servo</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../reports/">Build Reports</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Spectator Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Getting Started &raquo;</li>
        
      
    
    <li>Servo Comparison</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/Netflix/spectator" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="servo-comparison">Servo Comparison<a class="headerlink" href="#servo-comparison" title="Permanent link">&para;</a></h1>
<p><a href="https://github.com/Netflix/servo">Servo</a> is an alternative client monitoring
library that is also developed by Netflix. Originally spectator was an
experiment for a simpler API that wrapped servo. It was done as a separate
project to avoid breaking backwards compatibility for servo.</p>
<p>From a user perspective, both will be supported for a long time, but most
of our efforts for future improvement will go to spectator. For new code it
is recommended to use the spectator API. If running
<a href="../Netflix Integration">at Netflix</a> the correct bindings will be in place
for both servo and spectator.</p>
<h2 id="differences">Differences<a class="headerlink" href="#differences" title="Permanent link">&para;</a></h2>
<p>This section provides a quick summary of the differences.</p>
<h3 id="simpler-api">Simpler API<a class="headerlink" href="#simpler-api" title="Permanent link">&para;</a></h3>
<p>Servo gives the user a lot of control, but this makes it hard to use
correctly. For example, to create a counter the user needs to understand
the tradeoffs and choose between:</p>
<ul>
<li><a href="#basiccounter">BasicCounter</a></li>
<li><a href="#dynamiccounter">DynamicCounter</a></li>
<li><a href="#contextualcounter">ContextualCounter</a></li>
<li><a href="#stepcounter">StepCounter</a></li>
</ul>
<p>Further each of these can impact how data is reported to observers. The
spectator API focuses on the constructs a user needs to instrument the
code. In spectator the user would always use the registry to create a
<a href="../counter/">Counter</a>. The implementation details are left up to the
registry.</p>
<p>The <a href="#registration">registration</a> is simpler as well to avoid common pitfalls
when using servo like overwriting a registered object.</p>
<h3 id="more-focused">More Focused<a class="headerlink" href="#more-focused" title="Permanent link">&para;</a></h3>
<p>The goal of spectator is instrumenting code to send to a dimensional
time-series system like <a href="https://github.com/Netflix/atlas/wiki">Atlas</a>.
Servo has goals of staying compatible with a number of legacy libraries
and naming formats, exposing data to JMX, etc. Examples of how this
influences decisions:</p>
<ul>
<li>No support for non-numeric data. Servo supported this for exposing to JMX.
  Exposing the numeric data registered in spectator to JMX can be done
  using a registry that supports it, but there is no goal to be a general
  interface for exposing arbitrary data in JMX.</li>
<li>No support for customizeable time units when reporting timer data. Base
  units should always be used for reporting and conversions can be performed
  in the presentation layer if needed. It also avoids a lot of the confusion
  around the timer unit for the data and issues like creating aggregates that
  are meaningless because of mixed units.</li>
</ul>
<p>It is better to have a simple way to get correct and easy to reason about
data to the backend than many options. If you want more knobs, then you can use
Servo.</p>
<h3 id="di-friendly">DI Friendly<a class="headerlink" href="#di-friendly" title="Permanent link">&para;</a></h3>
<p>When servo was originally written dependency injection was not heavily used
at Netflix. Further servo needed to stay compatible with a number of use-cases
that were heavily static.</p>
<p>While spectator does have a static registry that can be used, the recommended
way is to create a registry and inject it either manually or via a framework
into the classes that need it. This also makes it much easier to
<a href="../Testing">test in isolation</a>.</p>
<h2 id="migration">Migration<a class="headerlink" href="#migration" title="Permanent link">&para;</a></h2>
<p>If you want to migrate from the servo API to the spectator API, then this
section provides some guides on how servo constructs can be ported over. The
sub-sections are the class names of monitor types supported by servo.</p>
<p>For users at Netflix, note we are not actively pushing teams to migrate
or do any additional work. Servo is still supported and if it works for your
use-cases feel free to continue using it. </p>
<h3 id="registration">Registration<a class="headerlink" href="#registration" title="Permanent link">&para;</a></h3>
<p>First read through the <a href="https://github.com/Netflix/servo/wiki/Getting-Started#registration-of-metrics">servo docs on registration</a>.
In servo if you have a class like:</p>
<pre><code class="java">public class Foo {

  private AtomicInteger gauge;
  private Counter counter;

  public Foo(String id) {
    gauge = new AtomicInteger();
    counter = new BasicCounter(MonitorConfig.builder(&quot;counter&quot;).build());
    Monitors.registerObject(id, this);
  }

  @Monitor(name = &quot;gauge&quot;, type = DataSourceType.GAUGE)
  private int gauge() {
    return gauge.get();
  }

  public void doSomething() {
    ...
  }
}
</code></pre>

<p>The state of the class is in the member variables of an instance of <code>Foo</code>.
If multiple instances of class <code>Foo</code> are created with the same value for <code>id</code>,
then the last one will overwrite the others for the registration. So the
values getting reported will only be from the last instance registered. Also
the registry has a reference to the instance of <code>Foo</code> so it will never go
away.</p>
<p>For counters and timers one way to get around this is to use
<a href="#dynamiccounter">DynamicCounter</a> and <a href="#dynamictimer">DynamicTimer</a>
respectively. Those classes will automatically handle the registration and
expire if there is no activity. They also get used for cases where the set
of dimensions is not known up front.</p>
<p>Gauges need to sample the state of something so they need to have a reference
to an object that contains the state. So the user would need to ensure that
only a single copy was registered leading to patterns like:</p>
<pre><code class="java">class Foo {

  private static class FooStats {

    private AtomicInteger gauge;
    private Counter counter;

    public FooStats(String id) {
      gauge = new AtomicInteger();
      counter = new BasicCounter(MonitorConfig.builder(&quot;counter&quot;).build());
      Monitors.registerObject(id, this);
    }

    @Monitor(name = &quot;gauge&quot;, type = DataSourceType.GAUGE)
    private int gauge() {
      return gauge.get();
    }
  }

  private static ConcurrentHashMap&lt;String, FooStats&gt; STATS =
    new ConcurrentHashMap&lt;&gt;();

  private final FooStats stats;

  public Foo(String id) {
    stats = STATS.computeIfAbsent(id, (i) -&gt; new FooStats(i));
  }

  public void doSomething() {
    ...
    stats.update();
  }
}
</code></pre>

<p>This ensures that there is a single copy for a given id. In spectator this
example would look like: </p>
<pre><code class="java">public class Foo {

  private AtomicInteger gauge;
  private Counter counter;

  public Foo(Registry registry, String id) {
    Id gaugeId = registry.createId(&quot;gauge&quot;).withTag(&quot;id&quot;, id);
    gauge = registry.gauge(gaugeId, new AtomicInteger());
    counter = registry.counter(&quot;counter&quot;, &quot;id&quot;, id);
  }

  public void doSomething() {
    ...
  }
}
</code></pre>

<p>Everything using the same registry will get the same counter
instance if the same id is used. For the gauge the registry will
keep a weak reference and will sum the values if multiple instances are
present. Since it is a weak reference, nothing will prevent an instance of
<code>Foo</code> from getting garbage collected.</p>
<h3 id="annotations">Annotations<a class="headerlink" href="#annotations" title="Permanent link">&para;</a></h3>
<p>Annotations are not supported, use the appropriate meter type:</p>
<table>
<thead>
<tr>
<th>DataSourceType</th>
<th>Spectator Alternative</th>
</tr>
</thead>
<tbody>
<tr>
<td>COUNTER</td>
<td>[[Counter Usage]]</td>
</tr>
<tr>
<td>GAUGE</td>
<td>[[Gauge Usage]]</td>
</tr>
<tr>
<td>INFORMATIONAL</td>
<td>Not supported</td>
</tr>
</tbody>
</table>
<h3 id="basiccounter">BasicCounter<a class="headerlink" href="#basiccounter" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../counter/">counter usage</a>.</p>
<p>Servo:</p>
<pre><code class="java">public class Foo {
  private final Counter c =
    new BasicCounter(MonitorConfig.builder(&quot;name&quot;).build());

  public Foo(String id) {
    Monitors.registerObject(id, this);
  }

  public void doSomething() {
    c.increment();
  }
}
</code></pre>

<p>Spectator:</p>
<pre><code class="java">public class Foo {
  private final Counter c;

  @Inject
  public Foo(Registry registry, String id) {
    c = registry.counter(&quot;name&quot;, &quot;id&quot;, id);
  }

  public void doSomething() {
    c.increment();
  }
}
</code></pre>

<h3 id="basicgauge">BasicGauge<a class="headerlink" href="#basicgauge" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../gauge/">gauge usage</a>.</p>
<p>Servo:</p>
<pre><code class="java">public class Foo {
  private final BasicGauge g = new BasicGauge(
    MonitorConfig.builder(&quot;name&quot;).build(),
    this::getCurrentValue);

  public Foo(String id) {
    Monitors.registerObject(id, this);
  }
}
</code></pre>

<p>Spectator:</p>
<pre><code class="java">public class Foo {
  @Inject
  public Foo(Registry registry, String id) {
    Id gaugeId = registry.createId(&quot;name&quot;).withTag(&quot;id&quot;, id);
    registry.gauge(gaugeId, this, Foo::getCurrentValue);
  }
}
</code></pre>

<h3 id="basictimer">BasicTimer<a class="headerlink" href="#basictimer" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../timer/">timer usage</a>. Note in spectator the reported unit
for timers is always seconds and cannot be changed. Seconds is the base unit
and other units should only be used as a presentation detail. Servo allows
the unit to be customized and defaults to milliseconds.</p>
<p>Servo:</p>
<pre><code class="java">public class Foo {
  private final Timer t = new BasicTimer(
    MonitorConfig.builder(&quot;name&quot;).build(), TimeUnit.SECONDS);

  public Foo(String id) {
    Monitors.registerObject(id, this);
  }

  public void doSomething() {
    Stopwatch s = t.start();
    try {
      ...
    } finally {
      s.stop();
    }
  }
}
</code></pre>

<p>Spectator:</p>
<pre><code class="java">public class Foo {
  private final Timer t;

  @Inject
  public Foo(Registry registry, String id) {
    t = registry.timer(&quot;name&quot;, &quot;id&quot;, id);
  }

  public void doSomething() {
    t.record(() -&gt; {
      ...
    });
  }
}
</code></pre>

<h3 id="basicdistributionsummary">BasicDistributionSummary<a class="headerlink" href="#basicdistributionsummary" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../dist-summary/">distribution summary usage</a>.</p>
<p>Servo:</p>
<pre><code class="java">public class Foo {
  private final BasicDistributionSummary s = new BasicDistributionSummary(
    MonitorConfig.builder(&quot;name&quot;).build());

  public Foo(String id) {
    Monitors.registerObject(id, this);
  }

  public void doSomething() {
    ...
    s.record(getValue());
  }
}
</code></pre>

<p>Spectator:</p>
<pre><code class="java">public class Foo {
  private final DistributionSummary s;

  @Inject
  public Foo(Registry registry, String id) {
    s = registry.distributionSummary(&quot;name&quot;, &quot;id&quot;, id);
  }

  public void doSomething() {
    ...
    s.record(getValue());
  }
}
</code></pre>

<h3 id="basicinformational">BasicInformational<a class="headerlink" href="#basicinformational" title="Permanent link">&para;</a></h3>
<p>Not supported, see <a href="#differences">overview of differences</a>.</p>
<h3 id="basicstopwatch">BasicStopwatch<a class="headerlink" href="#basicstopwatch" title="Permanent link">&para;</a></h3>
<p>There isn't an explicit stopwatch class in spectator. Just use a timing
call directly. </p>
<p>Servo:</p>
<pre><code class="java">  public void doSomething() {
    Stopwatch s = timer.start();
    try {
      ...
    } finally {
      s.stop();
    }
  }
</code></pre>

<p>Spectator:</p>
<pre><code class="java">  public void doSomething() {
    final long s = System.nanoTime();
    try {
      ...
    } finally {
      timer.record(System.nanoTime() - s, TimeUnit.NANOSECONDS);
    }
  }
</code></pre>

<h3 id="buckettimer">BucketTimer<a class="headerlink" href="#buckettimer" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../Sandbox">sandbox documentation</a>. Note in spectator BucketTimer is
provided in the sandbox extension library and may change in future as we
gain more experience using it.</p>
<p>Servo:</p>
<pre><code class="java">public class Foo {
  private final Timer t = new BucketTimer(
    MonitorConfig.builder(&quot;name&quot;).build(),
    new BucketConfig.Builder()
      .withTimeUnit(TimeUnit.MILLISECONDS)
      .withBuckets(new long[] { 500, 2500, 5000, 10000 })
      .build());

  public Foo(String id) {
    Monitors.registerObject(id, this);
  }

  public void doSomething() {
    Stopwatch s = t.start();
    try {
      ...
    } finally {
      s.stop();
    }
  }
}
</code></pre>

<p>Spectator:</p>
<pre><code class="java">public class Foo {
  private final Timer t;

  @Inject
  public Foo(Registry registry, String id) {
    Id timerId = registry.createId(&quot;name&quot;, &quot;id&quot;, id);
    BucketFunction f = BucketFunctions.latency(10, TimeUnit.SECONDS);
    t = BucketTimer.get(registry, timerId, f);
  }

  public void doSomething() {
    t.record(() -&gt; {
      ...
    });
  }
}
</code></pre>

<h3 id="contextualcounter">ContextualCounter<a class="headerlink" href="#contextualcounter" title="Permanent link">&para;</a></h3>
<p>Not supported. A fixed tag list for the context is too rigid and this class
was never used much at Netflix. Future work being looked at in
<a href="https://github.com/Netflix/spectator/issues/180">issue-180</a>.</p>
<h3 id="contextualtimer">ContextualTimer<a class="headerlink" href="#contextualtimer" title="Permanent link">&para;</a></h3>
<p>Not supported. A fixed tag list for the context is too rigid and this class
was never used much at Netflix. Future work being looked at in
<a href="https://github.com/Netflix/spectator/issues/180">issue-180</a>.</p>
<h3 id="doublegauge">DoubleGauge<a class="headerlink" href="#doublegauge" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../gauge/">gauge usage</a>.</p>
<p>Servo:</p>
<pre><code class="java">public class Foo {
  private final DoubleGauge g = new DoubleGauge(
    MonitorConfig.builder(&quot;name&quot;).build());

  public Foo(String id) {
    Monitors.registerObject(id, this);
  }
}
</code></pre>

<p>Spectator:</p>
<pre><code class="java">import com.google.common.util.concurrent.AtomicDouble;

public class Foo {
  private final AtomicDouble v;

  @Inject
  public Foo(Registry registry, String id) {
    Id gaugeId = registry.createId(&quot;name&quot;).withTag(&quot;id&quot;, id);
    v = registry.gauge(gaugeId, new AtomicDouble());
  }
}
</code></pre>

<h3 id="durationtimer">DurationTimer<a class="headerlink" href="#durationtimer" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../timer/#longtasktimer">timer usage</a>.</p>
<p>Servo:</p>
<pre><code class="java">public class Foo {
  private final DurationTimer t = new DurationTimer(
    MonitorConfig.builder(&quot;name&quot;).build());

  public Foo(String id) {
    Monitors.registerObject(id, this);
  }
}
</code></pre>

<p>Spectator:</p>
<pre><code class="java">public class Foo {
  private final LongTaskTimer t;

  @Inject
  public Foo(Registry registry, String id) {
    t = registry.longTaskTimer(&quot;name&quot;, &quot;id&quot;, id);
  }
}
</code></pre>

<h3 id="dynamiccounter">DynamicCounter<a class="headerlink" href="#dynamiccounter" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../counter/">counter usage</a>.</p>
<p>Servo:</p>
<pre><code class="java">public class Foo {

  private final String id;

  public Foo(String id) {
    this.id = id;
  }

  public void doSomething(Context ctxt) {
    DynamicCounter.increment(&quot;staticId&quot;, &quot;id&quot;, id);
    DynamicCounter.increment(&quot;dynamicId&quot;, &quot;id&quot;, id, &quot;foo&quot;, ctxt.getFoo());
  }
}
</code></pre>

<p>Spectator:</p>
<pre><code class="java">public class Foo {
  private final Registry registry;
  private final String id;
  private final Counter staticCounter;
  private final Id dynamicId;

  @Inject
  public Foo(Registry registry, String id) {
    this.registry = registry;
    this.id = id;
    staticCounter = registry.counter(&quot;staticId&quot;, &quot;id&quot;, id);
    dynamicId = registry.createId(&quot;dynamicId&quot;, &quot;id&quot;, id);
  }

  public void doSomething(Context ctxt) {
    // Keeping the reference to the counter avoids additional allocations
    // to create the id object and the lookup cost
    staticCounter.increment();

    // If the id is dynamic it must be looked up
    registry.counter(&quot;dynamicId&quot;, &quot;id&quot;, id, &quot;foo&quot;, ctxt.getFoo()).increment();

    // This will update the same counter as the line above, but the base part
    // of the id is precomputed to make it cheaper to construct the id.
    registry.counter(dynamicId.withTag(&quot;foo&quot;, ctxt.getFoo())).increment();
  }
}
</code></pre>

<h3 id="dynamictimer">DynamicTimer<a class="headerlink" href="#dynamictimer" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../timer/">timer usage</a>.</p>
<p>Servo:</p>
<pre><code class="java">public class Foo {

  private final String id;
  private final MonitorConfig staticId;

  public Foo(String id) {
    this.id = id;
    staticId = MonitorConfig.builder(&quot;staticId&quot;).withTag(&quot;id&quot;, id).build();
  }

  public void doSomething(Context ctxt) {
    final long d = ctxt.getDurationMillis();
    DynamicTimer.record(staticId, TimeUnit.SECONDS, d, TimeUnit.MILLISECONDS);

    MonitorConfig dynamicId = MonitorConfig.builder(&quot;dynamicId&quot;)
      .withTag(&quot;id&quot;, id)
      .withTag(&quot;foo&quot;, ctxt.getFoo())
      .build();
    DynamicTimer.record(dynamicId, TimeUnit.SECONDS, d, TimeUnit.MILLISECONDS);
  }
}
</code></pre>

<p>Spectator:</p>
<pre><code class="java">public class Foo {
  private final Registry registry;
  private final String id;
  private final Timer staticTimer;
  private final Id dynamicId;

  @Inject
  public Foo(Registry registry, String id) {
    this.registry = registry;
    this.id = id;
    staticTimer = registry.timer(&quot;staticId&quot;, &quot;id&quot;, id);
    dynamicId = registry.createId(&quot;dynamicId&quot;, &quot;id&quot;, id);
  }

  public void doSomething(Context ctxt) {
    final long d = ctxt.getDurationMillis();

    // Keeping the reference to the timer avoids additional allocations
    // to create the id object and the lookup cost
    staticTimer.record(d, TimeUnit.MILLISECONDS);

    // If the id is dynamic it must be looked up
    registry.timer(&quot;dynamicId&quot;, &quot;id&quot;, id, &quot;foo&quot;, ctxt.getFoo())
      .record(d, TimeUnit.MILLISECONDS);

    // This will update the same timer as the line above, but the base part
    // of the id is precomputed to make it cheaper to construct the id.
    registry.timer(dynamicId.withTag(&quot;foo&quot;, ctxt.getFoo()))
      .record(d, TimeUnit.MILLISECONDS);
  }
}
</code></pre>

<h3 id="longgauge">LongGauge<a class="headerlink" href="#longgauge" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../gauge/">gauge usage</a>.</p>
<p>Servo:</p>
<pre><code class="java">public class Foo {
  private final LongGauge g = new LongGauge(
    MonitorConfig.builder(&quot;name&quot;).build());

  public Foo(String id) {
    Monitors.registerObject(id, this);
  }
}
</code></pre>

<p>Spectator:</p>
<pre><code class="java">public class Foo {
  private final AtomicLong v;

  @Inject
  public Foo(Registry registry, String id) {
    Id gaugeId = registry.createId(&quot;name&quot;).withTag(&quot;id&quot;, id);
    v = registry.gauge(gaugeId, new AtomicLong());
  }
}
</code></pre>

<h3 id="monitorconfig">MonitorConfig<a class="headerlink" href="#monitorconfig" title="Permanent link">&para;</a></h3>
<p>See the documentation on <a href="../conventions/">naming</a>.</p>
<p>Servo:</p>
<pre><code class="java">MonitorConfig id = MonitorConfig.builder(&quot;name&quot;)
  .withTag(&quot;country&quot;, &quot;US&quot;)
  .withTag(&quot;device&quot;,  &quot;xbox&quot;)
  .build();
</code></pre>

<p>Spectator:</p>
<pre><code class="java">Id id = registry.createId(&quot;name&quot;)
  .withTag(&quot;country&quot;, &quot;US&quot;)
  .withTag(&quot;device&quot;,  &quot;xbox&quot;);

// or

Id id = registry.createId(&quot;name&quot;, &quot;country&quot;, &quot;US&quot;, &quot;device&quot;, &quot;xbox&quot;);
</code></pre>

<h3 id="monitoredcache">MonitoredCache<a class="headerlink" href="#monitoredcache" title="Permanent link">&para;</a></h3>
<p>Not supported because spectator does not have a direct dependency on guava.
If there is enough demand an extension can be created.</p>
<h3 id="numbergauge">NumberGauge<a class="headerlink" href="#numbergauge" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../gauge/">gauge usage</a>.</p>
<p>Servo:</p>
<pre><code class="java">public class Foo {
  private final NumberGauge g = new NumberGauge(
    MonitorConfig.builder(&quot;name&quot;).build(), new AtomicLong());

  public Foo(String id) {
    Monitors.registerObject(id, this);
  }
}
</code></pre>

<p>Spectator:</p>
<pre><code class="java">public class Foo {
  private final AtomicLong v;

  @Inject
  public Foo(Registry registry, String id) {
    Id gaugeId = registry.createId(&quot;name&quot;).withTag(&quot;id&quot;, id);
    v = registry.gauge(gaugeId, new AtomicLong());
  }
}
</code></pre>

<h3 id="statstimer">StatsTimer<a class="headerlink" href="#statstimer" title="Permanent link">&para;</a></h3>
<p>Not supported, see <a href="#differences">overview of differences</a>.</p>
<h3 id="stepcounter">StepCounter<a class="headerlink" href="#stepcounter" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../counter/">counter usage</a>.</p>
<p>Servo:</p>
<pre><code class="java">public class Foo {
  private final Counter c =
    new StepCounter(MonitorConfig.builder(&quot;name&quot;).build());

  public Foo(String id) {
    Monitors.registerObject(id, this);
  }

  public void doSomething() {
    c.increment();
  }
}
</code></pre>

<p>Spectator:</p>
<pre><code class="java">public class Foo {
  private final Counter c;

  @Inject
  public Foo(Registry registry, String id) {
    c = registry.counter(&quot;name&quot;, &quot;id&quot;, id);
  }

  public void doSomething() {
    c.increment();
  }
}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../ext/jvm-buffer-pools/" class="btn btn-neutral float-right" title="Buffer Pools">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../netflix/" class="btn btn-neutral" title="Netflix Integration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/Netflix/spectator" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../netflix/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../ext/jvm-buffer-pools/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
